<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="./favicon.ico" />
    <!-- Preload is necessary because we show these images when we disconnect from the server,
    but at that point we cannot load these images from the server -->
    <link rel="preload" href="./assets/gradient-yHQUC_QB.png" as="image" />
    <link rel="preload" href="./assets/noise-60BoTA8O.png" as="image" />
    <!-- Preload the fonts -->
    <link rel="preload" href="./assets/Lora-VariableFont_wght-B2ootaw-.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Regular-CxL0S8W7.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/PTSans-Bold-D9fedIX3.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Regular-BTCkDNvf.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Medium-DU3aDxX5.ttf" as="font" crossorigin="anonymous" />
    <link rel="preload" href="./assets/FiraMono-Bold-CLVRCuM9.ttf" as="font" crossorigin="anonymous" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta name="description" content="a marimo app" />
    <link rel="apple-touch-icon" href="./apple-touch-icon.png" />
    <link rel="manifest" href="./manifest.json" />

    <script data-marimo="true">
      function __resizeIframe(obj) {
        var scrollbarHeight = 20; // Max between windows, mac, and linux

        function setHeight() {
          var element = obj.contentWindow.document.documentElement;
          // If there is no vertical scrollbar, we don't need to resize the iframe
          if (element.scrollHeight === element.clientHeight) {
            return;
          }

          // Create a new height that includes the scrollbar height if it's visible
          var hasHorizontalScrollbar = element.scrollWidth > element.clientWidth;
          var newHeight = element.scrollHeight + (hasHorizontalScrollbar ? scrollbarHeight : 0);

          // Only update the height if it's different from the current height
          if (obj.style.height !== `${newHeight}px`) {
            obj.style.height = `${newHeight}px`;
          }
        }

        // Resize the iframe to the height of the content and bottom scrollbar height
        setHeight();

        // Resize the iframe when the content changes
        const resizeObserver = new ResizeObserver((entries) => {
          setHeight();
        });
        resizeObserver.observe(obj.contentWindow.document.body);
      }
    </script>
    <marimo-filename hidden>notebook.py</marimo-filename>
    <marimo-mode data-mode='read' hidden></marimo-mode>
    <marimo-version data-version='0.11.31' hidden></marimo-version>
    <marimo-user-config data-config='{"completion": {"activate_on_typing": true, "copilot": false}, "display": {"code_editor_font_size": 14, "default_width": "medium", "theme": "light", "dataframes": "rich", "cell_output": "above"}, "formatting": {"line_length": 79}, "keymap": {"preset": "default", "overrides": {}}, "runtime": {"auto_instantiate": true, "auto_reload": "off", "on_cell_change": "autorun", "watcher_on_save": "lazy", "output_max_bytes": 8000000, "std_stream_max_bytes": 1000000, "pythonpath": []}, "save": {"autosave": "off", "autosave_delay": 1000, "format_on_save": false}, "package_management": {"manager": "uv"}, "server": {"browser": "default", "follow_symlink": false}, "language_servers": {"pylsp": {"enabled": true, "enable_mypy": true, "enable_ruff": true, "enable_flake8": false, "enable_pydocstyle": false, "enable_pylint": false, "enable_pyflakes": false}}, "snippets": {"custom_paths": [], "include_default_snippets": true}}' data-overrides='{}' hidden></marimo-user-config>
    <marimo-app-config data-config='{"width": "medium"}' hidden></marimo-app-config>
    <marimo-server-token data-token='123' hidden></marimo-server-token>
    <title>notebook</title>
    <script type="module" crossorigin src="./assets/index-4KILascB.js"></script>
    <link rel="stylesheet" crossorigin href="./assets/index-C2p7kISM.css">
  <marimo-wasm hidden=""></marimo-wasm>
    <script>
        if (window.location.protocol === 'file:') {
            alert('Warning: This file must be served by an HTTP server to function correctly.');
        }
    </script>
    
    <style>
        #save-button {
            display: none !important;
        }
        #filename-input {
            display: none !important;
        }
    </style>
    <marimo-code hidden="" data-show-code="false">import%20marimo%0A%0A__generated_with%20%3D%20%220.11.31%22%0Aapp%20%3D%20marimo.App(width%3D%22medium%22)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%0A%20%20%20%20%20%20%20%20r%22%22%22%0A%20%20%20%20%20%20%20%20%23%20Understanding%20F-Score%20in%20Binary%20Classification%0A%0A%20%20%20%20%20%20%20%20The%20F-Score%20is%20a%20crucial%20metric%20in%20machine%20learning%20that%20provides%20a%20balanced%20measure%20of%20a%20model's%20predictive%20performance%20by%20combining%20precision%20and%20recall.%20It's%20particularly%20valuable%20when%20dealing%20with%20imbalanced%20datasets.%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20).center()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20math%20definition%20accordion%0A%20%20%20%20definition%20%3D%20mo.md(r%22%22%22%0A%20%20%20%20The%20F-%CE%B2%20Score%20is%20defined%20mathematically%20as%3A%0A%0A%20%20%20%20%5C%5B%0A%20%20%20%20F_%7B%5Cbeta%7D%20%3D%20%5Cfrac%7B(1%20%2B%20%5Cbeta%5E2)%20%5Ccdot%20%5Ctext%7Bprecision%7D%20%5Ccdot%20%5Ctext%7Brecall%7D%7D%7B%5Cbeta%5E2%20%5Ccdot%20%5Ctext%7Bprecision%7D%20%2B%20%5Ctext%7Brecall%7D%7D%0A%20%20%20%20%5C%5D%0A%0A%20%20%20%20Key%20Components%3A%0A%0A%20%20%20%20-%20**Precision**%3A%20%24%5Cfrac%7B%5Ctext%7BTrue%20Positives%7D%7D%7B%5Ctext%7BTrue%20Positives%20%2B%20False%20Positives%7D%7D%24%0A%0A%20%20%20%20-%20**Recall**%3A%20%24%5Cfrac%7B%5Ctext%7BTrue%20Positives%7D%7D%7B%5Ctext%7BTrue%20Positives%20%2B%20False%20Negatives%7D%7D%24%0A%0A%20%20%20%20-%20**%CE%B2**%3A%20Controls%20the%20balance%20between%20precision%20and%20recall%0A%0A%20%20%20%20%20%20%20%20%20%20-%20%CE%B2%20%3D%201%3A%20F1-Score%20(balanced)%0A%0A%20%20%20%20%20%20%20%20%20%20-%20%CE%B2%20%3E%201%3A%20More%20weight%20on%20recall%0A%0A%20%20%20%20%20%20%20%20%20%20-%20%CE%B2%20%3C%201%3A%20More%20weight%20on%20precision%0A%20%20%20%20%22%22%22)%0A%0A%20%20%20%20mo.accordion(%7B%22%23%23%23%20Mathematical%20Formulation%22%3A%20definition%7D)%0A%20%20%20%20return%20(definition%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%0A%20%20%20%201.%20**Choose%20a%20scenario**%20from%20the%20dropdown%20or%20enter%20your%20own%20labels%0A%20%20%20%202.%20**Set%20the%20%CE%B2%20value**%20to%20balance%20precision%20vs.%20recall%0A%20%20%20%203.%20**Calculate**%20%E2%86%92%20**Visualize**%20%E2%86%92%20**Compare**%20the%20results!%0A%20%20%20%20%22%22%22).callout(kind%3D%22warn%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(%22%22%22%23%23%23%20How%20to%20Use%20This%20Notebook%3A%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(journey_diagram%2C%20mo)%3A%0A%20%20%20%20mo.mermaid(journey_diagram)%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(input_section)%3A%0A%20%20%20%20input_section%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(calculate_button)%3A%0A%20%20%20%20calculate_button.center()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(beta_input%2C%20calculate_button%2C%20f_score%2C%20mo%2C%20pd%2C%20pred_values%2C%20true_values)%3A%0A%20%20%20%20%23%20Display%20relevant%20results%0A%20%20%20%20result_display%20%3D%20None%0A%20%20%20%20error_message%20%3D%20None%0A%0A%20%20%20%20%23%20Initialize%20result%20values%20as%20None%20(For%20display%20at%20the%20end)%0A%20%20%20%20f_beta_score%20%3D%20None%0A%20%20%20%20precision_val%20%3D%20None%0A%20%20%20%20recall_val%20%3D%20None%0A%20%20%20%20conf_matrix%20%3D%20None%0A%20%20%20%20tn_val%20%3D%20fp_val%20%3D%20fn_val%20%3D%20tp_val%20%3D%20None%0A%20%20%20%20specificity_val%20%3D%20accuracy_val%20%3D%20None%0A%0A%20%20%20%20if%20calculate_button.value%3A%0A%20%20%20%20%20%20%20%20%23%20Use%20the%20values%20from%20dropdown%0A%20%20%20%20%20%20%20%20result%20%3D%20f_score(true_values%2C%20pred_values%2C%20beta_input.value)%0A%0A%20%20%20%20%20%20%20%20if%20len(result)%20%3D%3D%205%3A%20%20%23%20Error%20occurred%0A%20%20%20%20%20%20%20%20%20%20%20%20_%2C%20_%2C%20_%2C%20_%2C%20error_str%20%3D%20result%0A%20%20%20%20%20%20%20%20%20%20%20%20error_message%20%3D%20mo.md(f%22%E2%9A%A0%EF%B8%8F%20**Error%3A**%20%7Berror_str%7D%22).callout(kind%3D%22danger%22)%0A%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20f_beta_score%2C%20precision_val%2C%20recall_val%2C%20conf_matrix%20%3D%20result%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Create%20metrics%20display%20appropriate%20formatting%0A%20%20%20%20%20%20%20%20%20%20%20%20metrics_display%20%3D%20mo.hstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.stat(f%22F%7Bbeta_input.value%3A.1f%7D%20Score%22%2C%20f%22%7Bf_beta_score%3A.3f%7D%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.stat(%22Precision%22%2C%20f%22%7Bprecision_val%3A.3f%7D%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.stat(%22Recall%22%2C%20f%22%7Brecall_val%3A.3f%7D%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Extract%20values%20from%20CF%0A%20%20%20%20%20%20%20%20%20%20%20%20tn_val%2C%20fp_val%2C%20fn_val%2C%20tp_val%20%3D%20conf_matrix.ravel()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20values_df%20%3D%20pd.DataFrame(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Btn_val%2C%20fp_val%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bfn_val%2C%20tp_val%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%2C%20index%3D%5B%22Actual%3A%200%22%2C%20%22Actual%3A%201%22%5D%2C%20columns%3D%5B%22Predicted%3A%200%22%2C%20%22Predicted%3A%201%22%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20cm_table%20%3D%20mo.ui.table(values_df%2C%20selection%3DNone)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20additional%20derived%20metrics%0A%20%20%20%20%20%20%20%20%20%20%20%20specificity_val%20%3D%20tn_val%20%2F%20(tn_val%20%2B%20fp_val)%20if%20(tn_val%20%2B%20fp_val)%20%3E%200%20else%200%0A%20%20%20%20%20%20%20%20%20%20%20%20accuracy_val%20%3D%20(tp_val%20%2B%20tn_val)%20%2F%20(tp_val%20%2B%20tn_val%20%2B%20fp_val%20%2B%20fn_val)%20if%20(tp_val%20%2B%20tn_val%20%2B%20fp_val%20%2B%20fn_val)%20%3E%200%20else%200%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20additional_metrics%20%3D%20mo.hstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.stat(%22Accuracy%22%2C%20f%22%7Baccuracy_val%3A.3f%7D%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.stat(%22Specificity%22%2C%20f%22%7Bspecificity_val%3A.3f%7D%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20interpretation%20based%20on%20values%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20precision_val%20%3E%200.7%20and%20recall_val%20%3C%200.3%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20interpretation%20%3D%20%22This%20model%20has%20good%20precision%20but%20poor%20recall.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20recall_val%20%3E%200.7%20and%20precision_val%20%3C%200.3%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20interpretation%20%3D%20%22This%20model%20has%20good%20recall%20but%20poor%20precision.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20abs(precision_val%20-%20recall_val)%20%3C%200.2%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20interpretation%20%3D%20%22This%20model%20is%20balanced%20between%20precision%20and%20recall.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20precision_val%20%3C%200.5%20and%20recall_val%20%3C%200.5%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20interpretation%20%3D%20%22This%20model%20needs%20improvement%20in%20both%20precision%20and%20recall.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20interpretation%20%3D%20%22This%20model%20performs%20reasonably%20well.%22%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20beta%20explanation%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20beta_input.value%20%3D%3D%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20beta_explanation%20%3D%20%22balanced%22%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20beta_input.value%20%3E%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20beta_explanation%20%3D%20%22more%20focus%20on%20recall%22%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20beta_explanation%20%3D%20%22more%20focus%20on%20precision%22%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20all%20components%20with%20improved%20formatting%0A%20%20%20%20%20%20%20%20%20%20%20%20result_display%20%3D%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.md(%22%23%23%20Results%22).center()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20metrics_display%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.md(%22%23%23%23%20Confusion%20Matrix%22).center()%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_table%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20additional_metrics%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.md(f%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20**Interpretation%3A**%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20A%20model%20with%20F%7Bbeta_input.value%3A.1f%7D%20Score%20of%20%7Bf_beta_score%3A.3f%7D%20has%20%7Bbeta_explanation%7D.%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20%7Binterpretation%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22).callout(kind%3D%22info%22)%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D)%0A%0A%20%20%20%20%23%20Return%20error%20message%20if%20there%20was%20an%20error%2C%20otherwise%20return%20result%20display%0A%20%20%20%20output%20%3D%20error_message%20if%20error_message%20else%20result_display%0A%20%20%20%20output%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20accuracy_val%2C%0A%20%20%20%20%20%20%20%20additional_metrics%2C%0A%20%20%20%20%20%20%20%20beta_explanation%2C%0A%20%20%20%20%20%20%20%20cm_table%2C%0A%20%20%20%20%20%20%20%20conf_matrix%2C%0A%20%20%20%20%20%20%20%20error_message%2C%0A%20%20%20%20%20%20%20%20error_str%2C%0A%20%20%20%20%20%20%20%20f_beta_score%2C%0A%20%20%20%20%20%20%20%20fn_val%2C%0A%20%20%20%20%20%20%20%20fp_val%2C%0A%20%20%20%20%20%20%20%20interpretation%2C%0A%20%20%20%20%20%20%20%20metrics_display%2C%0A%20%20%20%20%20%20%20%20output%2C%0A%20%20%20%20%20%20%20%20precision_val%2C%0A%20%20%20%20%20%20%20%20recall_val%2C%0A%20%20%20%20%20%20%20%20result%2C%0A%20%20%20%20%20%20%20%20result_display%2C%0A%20%20%20%20%20%20%20%20specificity_val%2C%0A%20%20%20%20%20%20%20%20tn_val%2C%0A%20%20%20%20%20%20%20%20tp_val%2C%0A%20%20%20%20%20%20%20%20values_df%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(confusion_matrix%2C%20go%2C%20mo%2C%20np%2C%20pd%2C%20pred_values%2C%20px%2C%20true_values)%3A%0A%20%20%20%20%23%20classification%20results%0A%20%20%20%20def%20create_visualizations()%3A%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20string%20inputs%20to%20numpy%20array%0A%20%20%20%20%20%20%20%20%20%20%20%20y_true_vis%20%3D%20np.array(%5Bint(x.strip())%20for%20x%20in%20true_values.split('%2C')%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20y_pred_vis%20%3D%20np.array(%5Bint(x.strip())%20for%20x%20in%20pred_values.split('%2C')%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20arrays%20are%20of%20equal%20length%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20len(y_true_vis)%20!%3D%20len(y_pred_vis)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20mo.md(%22Error%3A%20True%20and%20predicted%20labels%20must%20have%20the%20same%20length%22).callout(kind%3D%22danger%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20confusion%20matrix%20calc%0A%20%20%20%20%20%20%20%20%20%20%20%20cm_vis%20%3D%20confusion_matrix(y_true_vis%2C%20y_pred_vis)%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20cm_vis.shape%20!%3D%20(2%2C%202)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20Handle%20case%20with%20missing%20classes%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20cm_vis.shape%20%3D%3D%20(1%2C%201)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20class_val%20%3D%200%20if%20y_true_vis%5B0%5D%20%3D%3D%200%20else%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20expanded%20%3D%20np.zeros((2%2C%202))%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20expanded%5Bclass_val%2C%20class_val%5D%20%3D%20cm_vis%5B0%2C%200%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_vis%20%3D%20expanded%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%20mo.md(%22Error%3A%20Unexpected%20confusion%20matrix%20shape%22).callout(kind%3D%22danger%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Extract%20components%0A%20%20%20%20%20%20%20%20%20%20%20%20tn_vis%2C%20fp_vis%2C%20fn_vis%2C%20tp_vis%20%3D%20cm_vis.ravel()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20confusion%20matrix%20heatmap%20with%20improved%20styling%0A%20%20%20%20%20%20%20%20%20%20%20%20z%20%3D%20np.array(%5B%5Btn_vis%2C%20fp_vis%5D%2C%20%5Bfn_vis%2C%20tp_vis%5D%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20text%20annotations%20with%20categories%20and%20values%0A%20%20%20%20%20%20%20%20%20%20%20%20text_annotations%20%3D%20%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bf'TN%3A%20%7Btn_vis%7D'%2C%20f'FP%3A%20%7Bfp_vis%7D'%5D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bf'FN%3A%20%7Bfn_vis%7D'%2C%20f'TP%3A%20%7Btp_vis%7D'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20heatmap%20%3D%20go.Figure(data%3Dgo.Heatmap(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20z%3Dz%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3D%5B'Predicted%3A%200'%2C%20'Predicted%3A%201'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3D%5B'Actual%3A%200'%2C%20'Actual%3A%201'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%3Dtext_annotations%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20texttemplate%3D%22%25%7Btext%7D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20colorscale%3D'Blues'%0A%20%20%20%20%20%20%20%20%20%20%20%20))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20heatmap.update_layout(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%3D'Confusion%20Matrix%20Heatmap'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20height%3D400%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20margin%3Ddict(t%3D50%2C%20b%3D50%2C%20l%3D50%2C%20r%3D50)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20font%3Ddict(size%3D12)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Calculate%20precision%20and%20recall%0A%20%20%20%20%20%20%20%20%20%20%20%20precision_vis%20%3D%20tp_vis%20%2F%20(tp_vis%20%2B%20fp_vis)%20if%20(tp_vis%20%2B%20fp_vis)%20%3E%200%20else%200%0A%20%20%20%20%20%20%20%20%20%20%20%20recall_vis%20%3D%20tp_vis%20%2F%20(tp_vis%20%2B%20fn_vis)%20if%20(tp_vis%20%2B%20fn_vis)%20%3E%200%20else%200%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20precision-recall%20bar%20chart%20with%20decent%20styling%0A%20%20%20%20%20%20%20%20%20%20%20%20metrics_bar%20%3D%20go.Figure(data%3D%5Bgo.Bar(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3D%5B'Precision'%2C%20'Recall'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3D%5Bprecision_vis%2C%20recall_vis%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%3D%5Bf'%7Bprecision_vis%3A.3f%7D'%2C%20f'%7Brecall_vis%3A.3f%7D'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20textposition%3D'auto'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20marker_color%3D%5B'rgba(255%2C99%2C132%2C0.7)'%2C%20'rgba(54%2C162%2C235%2C0.7)'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20)%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20metrics_bar.update_layout(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%3D'Precision%20and%20Recall'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20yaxis_range%3D%5B0%2C%201%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20height%3D400%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20margin%3Ddict(t%3D50%2C%20b%3D50%2C%20l%3D50%2C%20r%3D50)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20visual%20representation%20of%20predictions%0A%20%20%20%20%20%20%20%20%20%20%20%20classifications%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20i%20in%20range(len(y_true_vis))%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20y_true_vis%5Bi%5D%20%3D%3D%201%20and%20y_pred_vis%5Bi%5D%20%3D%3D%201%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20classifications.append('TP')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20elif%20y_true_vis%5Bi%5D%20%3D%3D%200%20and%20y_pred_vis%5Bi%5D%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20classifications.append('TN')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20elif%20y_true_vis%5Bi%5D%20%3D%3D%201%20and%20y_pred_vis%5Bi%5D%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20classifications.append('FN')%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%20%20%23%20y_true_vis%5Bi%5D%20%3D%3D%200%20and%20y_pred_vis%5Bi%5D%20%3D%3D%201%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20classifications.append('FP')%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20DataFrame%20for%20visualization%0A%20%20%20%20%20%20%20%20%20%20%20%20df_vis%20%3D%20pd.DataFrame(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Index'%3A%20range(len(y_true_vis))%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'True%20Label'%3A%20y_true_vis%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Predicted%20Label'%3A%20y_pred_vis%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Classification'%3A%20classifications%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20color%20map%20for%20classifications%20with%20improved%20colors%0A%20%20%20%20%20%20%20%20%20%20%20%20colors%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'TP'%3A%20'rgba(99%2C%20255%2C%20132%2C%200.8)'%2C%20%20%23%20Green%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'TN'%3A%20'rgba(99%2C%20132%2C%20255%2C%200.8)'%2C%20%20%23%20Blue%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'FP'%3A%20'rgba(255%2C%2099%2C%20132%2C%200.8)'%2C%20%20%23%20Red%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'FN'%3A%20'rgba(255%2C%20206%2C%2086%2C%200.8)'%20%20%20%23%20Yellow%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20summary%20of%20classifications%0A%20%20%20%20%20%20%20%20%20%20%20%20tp_count%20%3D%20classifications.count('TP')%0A%20%20%20%20%20%20%20%20%20%20%20%20tn_count%20%3D%20classifications.count('TN')%0A%20%20%20%20%20%20%20%20%20%20%20%20fp_count%20%3D%20classifications.count('FP')%0A%20%20%20%20%20%20%20%20%20%20%20%20fn_count%20%3D%20classifications.count('FN')%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20improved%20scatter%20plot%0A%20%20%20%20%20%20%20%20%20%20%20%20predictions_fig%20%3D%20px.scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20df_vis%2C%20x%3D'Index'%2C%20y%3D'True%20Label'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color%3D'Classification'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20symbol%3D'Predicted%20Label'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20color_discrete_map%3Dcolors%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%3D'Prediction%20Results'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20labels%3D%7B'True%20Label'%3A%20'True%20Class'%2C%20'Predicted%20Label'%3A%20'Predicted%20Class'%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20height%3D400%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20predictions_fig.update_layout(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20margin%3Ddict(t%3D50%2C%20b%3D50%2C%20l%3D50%2C%20r%3D50)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20legend%3Ddict(orientation%3D'h'%2C%20yanchor%3D'bottom'%2C%20y%3D1.02%2C%20xanchor%3D'right'%2C%20x%3D1)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20summary%20of%20counts%0A%20%20%20%20%20%20%20%20%20%20%20%20classification_summary%20%3D%20mo.md(f%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20**Classification%20Summary%3A**%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**True%20Positives%20(TP)%3A**%20%7Btp_count%7D%20(correctly%20predicted%20positives)%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**True%20Negatives%20(TN)%3A**%20%7Btn_count%7D%20(correctly%20predicted%20negatives)%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**False%20Positives%20(FP)%3A**%20%7Bfp_count%7D%20(incorrectly%20predicted%20as%20positive)%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**False%20Negatives%20(FN)%3A**%20%7Bfn_count%7D%20(incorrectly%20predicted%20as%20negative)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20**Overall%20Accuracy%3A**%20%7B(tp_count%20%2B%20tn_count)%20%2F%20len(classifications)%3A.3f%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22).callout(kind%3D%22info%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20return%20the%20visualizations%20arranged%20in%20tabs%20with%20the%20summary%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mo.ui.tabs(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Confusion%20Matrix%22%3A%20heatmap%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Precision%20%26%20Recall%22%3A%20metrics_bar%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Predictions%22%3A%20predictions_fig%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20classification_summary%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D)%0A%0A%20%20%20%20%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20mo.md(f%22Error%20generating%20visualizations%3A%20%7Bstr(e)%7D%22).callout(kind%3D%22danger%22)%0A%0A%20%20%20%20%23%20visualization%20button%0A%20%20%20%20visualize_button%20%3D%20mo.ui.run_button(label%3D%22Visualize%20Results%22)%0A%20%20%20%20return%20create_visualizations%2C%20visualize_button%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(visualize_button)%3A%0A%20%20%20%20visualize_button.center()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(create_visualizations%2C%20visualize_button)%3A%0A%20%20%20%20%23%20render%20visualizations%0A%20%20%20%20visualizations%20%3D%20None%0A%20%20%20%20if%20visualize_button.value%3A%0A%20%20%20%20%20%20%20%20visualizations%20%3D%20create_visualizations()%0A%20%20%20%20visualizations%0A%20%20%20%20return%20(visualizations%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20add%20interactive%20F-score%20comparison%20for%20different%20beta%20values%0A%20%20%20%20mo.md(%22%23%23%20F-Score%20for%20Different%20%CE%B2%20Values%22).center()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(compare_button)%3A%0A%20%20%20%20compare_button.center()%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20%40mo.cache%0A%20%20%20%20def%20calculate_multiple_fscores(precision%2C%20recall%2C%20beta_values)%3A%0A%20%20%20%20%20%20%20%20%22%22%22Calculate%20F-scores%20for%20multiple%20beta%20values%22%22%22%0A%20%20%20%20%20%20%20%20f_scores%20%3D%20%5B%5D%0A%20%20%20%20%20%20%20%20for%20beta%20in%20beta_values%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20precision%20%2B%20recall%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f_scores.append(0)%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f_beta%20%3D%20((1%20%2B%20beta**2)%20*%20precision%20*%20recall)%20%2F%20((beta**2%20*%20precision)%20%2B%20recall)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f_scores.append(f_beta)%0A%20%20%20%20%20%20%20%20return%20f_scores%0A%0A%20%20%20%20compare_button%20%3D%20mo.ui.run_button(label%3D%22Compare%20F-Scores%22)%0A%20%20%20%20return%20calculate_multiple_fscores%2C%20compare_button%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(%0A%20%20%20%20calculate_multiple_fscores%2C%0A%20%20%20%20compare_button%2C%0A%20%20%20%20confusion_matrix%2C%0A%20%20%20%20go%2C%0A%20%20%20%20mo%2C%0A%20%20%20%20np%2C%0A%20%20%20%20pd%2C%0A%20%20%20%20precision_val%2C%0A%20%20%20%20pred_values%2C%0A%20%20%20%20recall_val%2C%0A%20%20%20%20true_values%2C%0A)%3A%0A%20%20%20%20comparison_result%20%3D%20None%0A%0A%20%20%20%20if%20compare_button.value%3A%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20if%20we%20already%20have%20precision%20and%20recall%20from%20previous%20calculations%2C%20use%20them%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20precision_val%20is%20not%20None%20and%20recall_val%20is%20not%20None%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20precision_comp%20%3D%20precision_val%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recall_comp%20%3D%20recall_val%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20otherwise%2C%20calculate%20them%20from%20the%20labels%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20string%20inputs%20to%20numpy%20array%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y_true_comp%20%3D%20np.array(%5Bint(x.strip())%20for%20x%20in%20true_values.split('%2C')%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y_pred_comp%20%3D%20np.array(%5Bint(x.strip())%20for%20x%20in%20pred_values.split('%2C')%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20confusion%20matrix%20calc%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_comp%20%3D%20confusion_matrix(y_true_comp%2C%20y_pred_comp)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20handle%20case%20where%20confusion%20matrix%20is%20smaller%20than%202x2%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20cm_comp.shape%20!%3D%20(2%2C%202)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20cm_comp.shape%20%3D%3D%20(1%2C%201)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20only%20one%20class%20appears%20-%20need%20to%20expand%20matrix%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20y_true_comp%5B0%5D%20%3D%3D%200%3A%20%20%23%20only%20negatives%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded_comp%20%3D%20np.zeros((2%2C%202)%2C%20dtype%3Dint)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded_comp%5B0%2C%200%5D%20%3D%20cm_comp%5B0%2C%200%5D%20%20%23%20TN%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_comp%20%3D%20cm_expanded_comp%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%20%20%23%20only%20positives%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded_comp%20%3D%20np.zeros((2%2C%202)%2C%20dtype%3Dint)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded_comp%5B1%2C%201%5D%20%3D%20cm_comp%5B0%2C%200%5D%20%20%23%20TP%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_comp%20%3D%20cm_expanded_comp%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(%22Unexpected%20confusion%20matrix%20shape%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20extract%20components%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20tn_comp%2C%20fp_comp%2C%20fn_comp%2C%20tp_comp%20%3D%20cm_comp.ravel()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20precision%20and%20recall%20calc%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20precision_comp%20%3D%20tp_comp%20%2F%20(tp_comp%20%2B%20fp_comp)%20if%20(tp_comp%20%2B%20fp_comp)%20%3E%200%20else%200%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recall_comp%20%3D%20tp_comp%20%2F%20(tp_comp%20%2B%20fn_comp)%20if%20(tp_comp%20%2B%20fn_comp)%20%3E%200%20else%200%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20F-scores%20calc%20for%20different%20beta%20values%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20beta_values_comp%20%3D%20%5B0.5%2C%201.0%2C%202.0%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20beta_labels_comp%20%3D%20%5B'F0.5'%2C%20'F1'%2C%20'F2'%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20f_scores_comp%20%3D%20calculate_multiple_fscores(precision_comp%2C%20recall_comp%2C%20beta_values_comp)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20comparison%20chart%20with%20improved%20styling%0A%20%20%20%20%20%20%20%20%20%20%20%20df_comp%20%3D%20pd.DataFrame(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Beta'%3A%20beta_labels_comp%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'F-Score'%3A%20f_scores_comp%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20'Emphasis'%3A%20%5B'Precision'%2C%20'Balanced'%2C%20'Recall'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20fig_comp%20%3D%20go.Figure()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20bars%20for%20F-scores%20with%20improved%20colors%0A%20%20%20%20%20%20%20%20%20%20%20%20fig_comp.add_trace(go.Bar(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Ddf_comp%5B'Beta'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3Ddf_comp%5B'F-Score'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20text%3D%5Bf'%7Bscore%3A.3f%7D'%20for%20score%20in%20f_scores_comp%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20textposition%3D'auto'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20marker_color%3D%5B'rgba(255%2C165%2C0%2C0.7)'%2C%20'rgba(0%2C128%2C0%2C0.7)'%2C%20'rgba(0%2C0%2C255%2C0.7)'%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20reference%20lines%20for%20precision%20and%20recall%0A%20%20%20%20%20%20%20%20%20%20%20%20fig_comp.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Ddf_comp%5B'Beta'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3D%5Bprecision_comp%5D%20*%20len(beta_values_comp)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%3D'Precision'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(color%3D'red'%2C%20width%3D2%2C%20dash%3D'dash')%0A%20%20%20%20%20%20%20%20%20%20%20%20))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20fig_comp.add_trace(go.Scatter(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20x%3Ddf_comp%5B'Beta'%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20y%3D%5Brecall_comp%5D%20*%20len(beta_values_comp)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20mode%3D'lines'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20name%3D'Recall'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20line%3Ddict(color%3D'blue'%2C%20width%3D2%2C%20dash%3D'dash')%0A%20%20%20%20%20%20%20%20%20%20%20%20))%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20fig_comp.update_layout(%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20title%3Df'F-Score%20Comparison%20(Precision%3A%20%7Bprecision_comp%3A.3f%7D%2C%20Recall%3A%20%7Brecall_comp%3A.3f%7D)'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20xaxis_title%3D'F-Score%20Type'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20yaxis_title%3D'Value'%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20yaxis_range%3D%5B0%2C%201%5D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20legend%3Ddict(orientation%3D'h'%2C%20yanchor%3D'bottom'%2C%20y%3D1.02%2C%20xanchor%3D'right'%2C%20x%3D1)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20height%3D400%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20margin%3Ddict(t%3D50%2C%20b%3D50%2C%20l%3D50%2C%20r%3D50)%0A%20%20%20%20%20%20%20%20%20%20%20%20)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20comparison%20text%20explaining%20differences%20with%20improved%20formatting%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20precision_comp%20%3E%20recall_comp%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20comparison_text%20%3D%20f%22When%20precision%20(%7Bprecision_comp%3A.3f%7D)%20%3E%20recall%20(%7Brecall_comp%3A.3f%7D)%2C%20F0.5%20%3E%20F2%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendation%20%3D%20%22higher%20precision%22%0A%20%20%20%20%20%20%20%20%20%20%20%20elif%20precision_comp%20%3C%20recall_comp%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20comparison_text%20%3D%20f%22When%20precision%20(%7Bprecision_comp%3A.3f%7D)%20%3C%20recall%20(%7Brecall_comp%3A.3f%7D)%2C%20F0.5%20%3C%20F2%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendation%20%3D%20%22higher%20recall%22%0A%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20comparison_text%20%3D%20f%22When%20precision%20(%7Bprecision_comp%3A.3f%7D)%20%3D%20recall%20(%7Brecall_comp%3A.3f%7D)%2C%20F0.5%20%3D%20F2%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20recommendation%20%3D%20%22balanced%20precision%20and%20recall%22%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20explanation%20with%20improved%20formatting%0A%20%20%20%20%20%20%20%20%20%20%20%20explanation_comp%20%3D%20mo.md(f%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20**F-Score%20Comparison%20Explained%3A**%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**F0.5%20(%7Bf_scores_comp%5B0%5D%3A.3f%7D)**%3A%20Emphasizes%20precision%20over%20recall%20(good%20for%20spam%20detection)%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**F1%20(%7Bf_scores_comp%5B1%5D%3A.3f%7D)**%3A%20Balances%20precision%20and%20recall%20equally%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**F2%20(%7Bf_scores_comp%5B2%5D%3A.3f%7D)**%3A%20Emphasizes%20recall%20over%20precision%20(good%20for%20medical%20screening)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20**For%20your%20current%20data%3A**%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20%7Bcomparison_text%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20This%20indicates%20that%20this%20model%20is%20better%20suited%20for%20tasks%20that%20require%20%7Brecommendation%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22).callout(kind%3D%22info%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20comparison_result%20%3D%20mo.vstack(%5Bfig_comp%2C%20explanation_comp%5D)%0A%0A%20%20%20%20%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20comparison_result%20%3D%20mo.md(f%22Error%20in%20F-score%20comparison%3A%20%7Bstr(e)%7D%22).callout(kind%3D%22danger%22)%0A%0A%20%20%20%20comparison_result%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20beta_labels_comp%2C%0A%20%20%20%20%20%20%20%20beta_values_comp%2C%0A%20%20%20%20%20%20%20%20cm_comp%2C%0A%20%20%20%20%20%20%20%20cm_expanded_comp%2C%0A%20%20%20%20%20%20%20%20comparison_result%2C%0A%20%20%20%20%20%20%20%20comparison_text%2C%0A%20%20%20%20%20%20%20%20df_comp%2C%0A%20%20%20%20%20%20%20%20explanation_comp%2C%0A%20%20%20%20%20%20%20%20f_scores_comp%2C%0A%20%20%20%20%20%20%20%20fig_comp%2C%0A%20%20%20%20%20%20%20%20fn_comp%2C%0A%20%20%20%20%20%20%20%20fp_comp%2C%0A%20%20%20%20%20%20%20%20precision_comp%2C%0A%20%20%20%20%20%20%20%20recall_comp%2C%0A%20%20%20%20%20%20%20%20recommendation%2C%0A%20%20%20%20%20%20%20%20tn_comp%2C%0A%20%20%20%20%20%20%20%20tp_comp%2C%0A%20%20%20%20%20%20%20%20y_pred_comp%2C%0A%20%20%20%20%20%20%20%20y_true_comp%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20conclusion%20and%20insights%0A%20%20%20%20conclusion%20%3D%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20mo.md(%22%23%23%20Key%20Takeaways%22).center()%2C%0A%20%20%20%20%20%20%20%20mo.callout(%0A%20%20%20%20%20%20%20%20%20%20%20%20mo.md(%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20**Key%20Insights%20about%20F-Score%3A**%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20Balances%20precision%20and%20recall%20according%20to%20your%20specific%20needs%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20F1-Score%20gives%20equal%20weight%20to%20precision%20and%20recall%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20F2-Score%20emphasizes%20finding%20all%20positive%20cases%20(high%20recall)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20F0.5-Score%20emphasizes%20avoiding%20false%20positives%20(high%20precision)%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20kind%3D%22success%22%0A%20%20%20%20%20%20%20%20)%2C%0A%20%20%20%20%20%20%20%20mo.accordion(%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%F0%9F%94%8D%20Practical%20Applications%22%3A%20mo.md(%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20**Medical%20Diagnosis**%3A%20Use%20F2-Score%20when%20missing%20a%20disease%20detection%20is%20costlier%20than%20a%20false%20alarm%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20**Spam%20Detection**%3A%20Use%20F0.5-Score%20when%20marking%20legitimate%20emails%20as%20spam%20is%20worse%20than%20missing%20some%20spam%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20**Fraud%20Detection**%3A%20Use%20F1-Score%20when%20both%20false%20alarms%20and%20missed%20frauds%20have%20similar%20costs%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20-%20**Information%20Retrieval**%3A%20Use%20different%20%CE%B2%20values%20based%20on%20user%20needs%20for%20precision%20vs.%20comprehensiveness%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22)%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%F0%9F%9A%80%20Advanced%20Exploration%22%3A%20mo.md(%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%201.%20Experiment%20with%20different%20%CE%B2%20values%20to%20understand%20their%20impact%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%202.%20Try%20various%20label%20combinations%20representing%20real-world%20scenarios%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%203.%20Understand%20how%20class%20imbalance%20affects%20F-Score%20calculation%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%204.%20Explore%20how%20different%20thresholds%20affect%20the%20precision-recall%20trade-off%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%205.%20Compare%20F-Score%20with%20other%20metrics%20like%20accuracy%2C%20ROC-AUC%2C%20and%20PR-AUC%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22)%0A%20%20%20%20%20%20%20%20%7D)%0A%20%20%20%20%5D)%0A%20%20%20%20return%20(conclusion%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(conclusion)%3A%0A%20%20%20%20conclusion%0A%20%20%20%20return%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20mo.md(r%22%22%22Appendix%20code%20(containing%20helper%20functions%20and%20code)%22%22%22)%0A%20%20%20%20return%0A%0A%0A%40app.cell%0Adef%20_()%3A%0A%20%20%20%20import%20marimo%20as%20mo%0A%20%20%20%20return%20(mo%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20import%20numpy%20as%20np%0A%20%20%20%20import%20pandas%20as%20pd%0A%20%20%20%20import%20plotly.graph_objects%20as%20go%0A%20%20%20%20import%20plotly.express%20as%20px%0A%20%20%20%20from%20sklearn.metrics%20import%20confusion_matrix%0A%20%20%20%20return%20confusion_matrix%2C%20go%2C%20np%2C%20pd%2C%20px%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo)%3A%0A%20%20%20%20%23%20Concept%20explanation%20accordion%0A%20%20%20%20concept_explanation%20%3D%20mo.accordion(%7B%0A%20%20%20%20%20%20%20%20%22%F0%9F%8E%AF%20When%20to%20Use%20F-Score%22%3A%20mo.md(%22%22%22%0A%20%20%20%20%20%20%20%20F-Score%20is%20especially%20valuable%20when%3A%0A%0A%20%20%20%20%20%20%20%201.%20**Class%20Imbalance**%3A%20When%20one%20class%20significantly%20outnumbers%20another%0A%20%20%20%20%20%20%20%202.%20**Cost-sensitive%20Scenarios**%3A%20When%20false%20positives%20and%20false%20negatives%20have%20different%20costs%0A%20%20%20%20%20%20%20%203.%20**Domain-specific%20Requirements**%3A%20When%20either%20precision%20or%20recall%20is%20more%20important%0A%0A%20%20%20%20%20%20%20%20Common%20%CE%B2%20values%3A%0A%20%20%20%20%20%20%20%20-%20**F1%20(%CE%B2%3D1)**%3A%20Balanced%20weight%20between%20precision%20and%20recall%0A%20%20%20%20%20%20%20%20-%20**F2%20(%CE%B2%3D2)**%3A%20Puts%20more%20emphasis%20on%20recall%20(finding%20all%20positives)%0A%20%20%20%20%20%20%20%20-%20**F0.5%20(%CE%B2%3D0.5)**%3A%20Puts%20more%20emphasis%20on%20precision%20(avoiding%20false%20positives)%0A%20%20%20%20%20%20%20%20%22%22%22)%2C%0A%0A%20%20%20%20%20%20%20%20%22%F0%9F%92%A1%20Real-world%20Examples%22%3A%20mo.md(%22%22%22%0A%20%20%20%20%20%20%20%20-%20**Medical%20Diagnosis%20(%CE%B2%3E1)**%3A%20When%20missing%20a%20disease%20detection%20(false%20negative)%20is%20more%20harmful%20than%20a%20false%20alarm%0A%20%20%20%20%20%20%20%20-%20**Spam%20Detection%20(%CE%B2%3C1)**%3A%20When%20marking%20legitimate%20emails%20as%20spam%20(false%20positive)%20is%20worse%20than%20missing%20some%20spam%0A%20%20%20%20%20%20%20%20-%20**Fraud%20Detection%20(balanced)**%3A%20When%20both%20false%20alarms%20and%20missed%20frauds%20are%20equally%20problematic%0A%20%20%20%20%20%20%20%20%22%22%22)%0A%20%20%20%20%7D)%0A%20%20%20%20return%20(concept_explanation%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20%23%20sampel%20scenario%20presets%20with%20detailed%20descriptions%0A%20%20%20%20scenarios%20%3D%20%7B%0A%20%20%20%20%20%20%20%20%22Custom%20(Current)%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22true%22%3A%20%221%2C%200%2C%201%2C%201%2C%200%2C%201%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22pred%22%3A%20%221%2C%200%2C%201%2C%200%2C%200%2C%201%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22description%22%3A%20%22Your%20custom%20input%20data%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%22Perfect%20Prediction%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22true%22%3A%20%221%2C%200%2C%201%2C%200%2C%201%2C%200%2C%201%2C%200%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22pred%22%3A%20%221%2C%200%2C%201%2C%200%2C%201%2C%200%2C%201%2C%200%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22description%22%3A%20%22Model%20perfectly%20predicts%20all%20labels%20(F-Score%20%3D%201.0)%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%22All%20Positive%20Predictions%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22true%22%3A%20%221%2C%200%2C%201%2C%200%2C%201%2C%200%2C%201%2C%200%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22pred%22%3A%20%221%2C%201%2C%201%2C%201%2C%201%2C%201%2C%201%2C%201%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22description%22%3A%20%22Model%20predicts%20everything%20as%20positive%20(high%20recall%2C%20low%20precision)%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%22All%20Negative%20Predictions%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22true%22%3A%20%221%2C%200%2C%201%2C%200%2C%201%2C%200%2C%201%2C%200%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22pred%22%3A%20%220%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22description%22%3A%20%22Model%20predicts%20everything%20as%20negative%20(zero%20recall)%22%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%22Imbalanced%20Dataset%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22true%22%3A%20%221%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%2C%201%2C%200%2C%200%2C%200%2C%200%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22pred%22%3A%20%221%2C%200%2C%200%2C%200%2C%201%2C%200%2C%200%2C%200%2C%201%2C%200%2C%200%2C%200%2C%200%2C%200%2C%200%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22description%22%3A%20%22Dataset%20with%20few%20positive%20examples%20(13%25%20positive)%2C%20showing%20how%20F-Score%20handles%20imbalance%22%0A%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%7D%0A%20%20%20%20return%20(scenarios%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(mo%2C%20scenarios)%3A%0A%20%20%20%20%23%20Selected%20scenario%0A%20%20%20%20example_scenarios%20%3D%20mo.ui.dropdown(%0A%20%20%20%20%20%20%20%20label%3D%22Load%20Example%20Scenario%22%2C%0A%20%20%20%20%20%20%20%20options%3Dlist(scenarios.keys())%2C%0A%20%20%20%20%20%20%20%20value%3D%22Custom%20(Current)%22%0A%20%20%20%20)%0A%20%20%20%20return%20(example_scenarios%2C)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(example_scenarios%2C%20mo%2C%20scenarios)%3A%0A%20%20%20%20%23%20set%20init%20values%20based%20on%20the%20default%20scenario%0A%20%20%20%20selected%20%3D%20scenarios%5Bexample_scenarios.value%5D%0A%0A%20%20%20%20true_labels%20%3D%20mo.ui.text_area(%0A%20%20%20%20%20%20%20%20label%3D%22True%20Labels%20(comma-separated%200s%20and%201s)%22%2C%0A%20%20%20%20%20%20%20%20value%3Dselected%5B%22true%22%5D%2C%0A%20%20%20%20%20%20%20%20placeholder%3D%22Enter%20binary%20labels%22%0A%20%20%20%20)%0A%0A%20%20%20%20pred_labels%20%3D%20mo.ui.text_area(%0A%20%20%20%20%20%20%20%20label%3D%22Predicted%20Labels%20(comma-separated%200s%20and%201s)%22%2C%0A%20%20%20%20%20%20%20%20value%3Dselected%5B%22pred%22%5D%2C%0A%20%20%20%20%20%20%20%20placeholder%3D%22Enter%20predicted%20labels%22%0A%20%20%20%20)%0A%0A%20%20%20%20beta_input%20%3D%20mo.ui.number(%0A%20%20%20%20%20%20%20%20label%3D%22%CE%B2%20(Beta)%20Value%22%2C%0A%20%20%20%20%20%20%20%20value%3D1.0%2C%0A%20%20%20%20%20%20%20%20step%3D0.1%2C%0A%20%20%20%20%20%20%20%20start%3D0.1%2C%0A%20%20%20%20%20%20%20%20stop%3D10%0A%20%20%20%20)%0A%20%20%20%20return%20beta_input%2C%20pred_labels%2C%20selected%2C%20true_labels%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(confusion_matrix%2C%20mo%2C%20np)%3A%0A%20%20%20%20%23%20F-Score%20calc%20function%0A%20%20%20%20def%20f_score(y_true%2C%20y_pred%2C%20beta)%3A%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20Calculate%20F-Beta%20Score%20for%20binary%20classification%0A%0A%20%20%20%20%20%20%20%20Args%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20y_true%20(str)%3A%20True%20binary%20labels%20as%20comma-separated%20string%0A%20%20%20%20%20%20%20%20%20%20%20%20y_pred%20(str)%3A%20Predicted%20binary%20labels%20as%20comma-separated%20string%0A%20%20%20%20%20%20%20%20%20%20%20%20beta%20(float)%3A%20Beta%20value%20for%20F-Score%0A%0A%20%20%20%20%20%20%20%20Returns%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20tuple%3A%20(F-Beta%20Score%2C%20precision%2C%20recall%2C%20confusion%20matrix)%20or%20(None%2C%20None%2C%20None%2C%20None%2C%20error_msg)%20on%20error%0A%20%20%20%20%20%20%20%20%22%22%22%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20string%20inputs%20to%20numpy%20array%2C%20handling%20potential%20whitespace%0A%20%20%20%20%20%20%20%20%20%20%20%20y_true_arr%20%3D%20np.array(%5Bint(x.strip())%20for%20x%20in%20y_true.split('%2C')%5D)%0A%20%20%20%20%20%20%20%20%20%20%20%20y_pred_arr%20%3D%20np.array(%5Bint(x.strip())%20for%20x%20in%20y_pred.split('%2C')%5D)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20ensure%20arrays%20are%20of%20equal%20length%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20len(y_true_arr)%20!%3D%20len(y_pred_arr)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(%22True%20and%20predicted%20label%20arrays%20must%20be%20of%20equal%20length%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20check%20that%20labels%20are%20binary%20(0s%20and%201s)%0A%20%20%20%20%20%20%20%20%20%20%20%20for%20arr%2C%20name%20in%20%5B(y_true_arr%2C%20%22True%20labels%22)%2C%20(y_pred_arr%2C%20%22Predicted%20labels%22)%5D%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20invalid_vals%20%3D%20%5Bx%20for%20x%20in%20arr%20if%20x%20not%20in%20%5B0%2C%201%5D%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20invalid_vals%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(f%22%7Bname%7D%20must%20contain%20only%200s%20and%201s.%20Found%3A%20%7Binvalid_vals%7D%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20compute%20confusion%20matrix%0A%20%20%20%20%20%20%20%20%20%20%20%20cm%20%3D%20confusion_matrix(y_true_arr%2C%20y_pred_arr)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20handle%20case%20where%20confusion%20matrix%20is%20smaller%20than%202x2%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20cm.shape%20!%3D%20(2%2C%202)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20this%20happens%20when%20one%20class%20is%20missing%20in%20both%20true%20and%20predicted%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20cm.shape%20%3D%3D%20(1%2C%201)%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%23%20only%20one%20class%20appears%20-%20need%20to%20expand%20matrix%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20if%20y_true_arr%5B0%5D%20%3D%3D%200%3A%20%20%23%20only%20negatives%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded%20%3D%20np.zeros((2%2C%202)%2C%20dtype%3Dint)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded%5B0%2C%200%5D%20%3D%20cm%5B0%2C%200%5D%20%20%23%20TN%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm%20%3D%20cm_expanded%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%20%20%23%20only%20positives%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded%20%3D%20np.zeros((2%2C%202)%2C%20dtype%3Dint)%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm_expanded%5B1%2C%201%5D%20%3D%20cm%5B0%2C%200%5D%20%20%23%20TP%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20cm%20%3D%20cm_expanded%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20raise%20ValueError(%22Unexpected%20confusion%20matrix%20shape.%20Ensure%20both%20classes%20are%20represented.%22)%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20extract%20values%20from%20confusion%20matrix%0A%20%20%20%20%20%20%20%20%20%20%20%20tn%2C%20fp%2C%20fn%2C%20tp%20%3D%20cm.ravel()%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20precision%20and%20recall%20calc%0A%20%20%20%20%20%20%20%20%20%20%20%20precision%20%3D%20tp%20%2F%20(tp%20%2B%20fp)%20if%20(tp%20%2B%20fp)%20%3E%200%20else%200%0A%20%20%20%20%20%20%20%20%20%20%20%20recall%20%3D%20tp%20%2F%20(tp%20%2B%20fn)%20if%20(tp%20%2B%20fn)%20%3E%200%20else%200%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20F-Beta%20Score%20calc%0A%20%20%20%20%20%20%20%20%20%20%20%20if%20precision%20%2B%20recall%20%3D%3D%200%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20return%200.0%2C%20precision%2C%20recall%2C%20cm%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20f_beta%20%3D%20((1%20%2B%20beta**2)%20*%20precision%20*%20recall)%20%2F%20((beta**2%20*%20precision)%20%2B%20recall)%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20round(f_beta%2C%203)%2C%20round(precision%2C%203)%2C%20round(recall%2C%203)%2C%20cm%0A%0A%20%20%20%20%20%20%20%20except%20Exception%20as%20e%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20return%20None%2C%20None%2C%20None%2C%20None%2C%20str(e)%0A%0A%20%20%20%20%23%20run%20button%20to%20calculate%20F-Score%0A%20%20%20%20calculate_button%20%3D%20mo.ui.run_button(label%3D%22Calculate%20F-Score%22)%0A%20%20%20%20return%20calculate_button%2C%20f_score%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_(beta_input%2C%20example_scenarios%2C%20mo%2C%20pred_labels%2C%20scenarios%2C%20true_labels)%3A%0A%20%20%20%20%23%20when%20dropdown%20changes%2C%20show%20what%20data%20is%20being%20used%0A%20%20%20%20selected_scenario%20%3D%20scenarios%5Bexample_scenarios.value%5D%0A%0A%20%20%20%20%23%20display%20message%20about%20the%20selected%20scenario%0A%20%20%20%20if%20example_scenarios.value%20%3D%3D%20%22Custom%20(Current)%22%3A%0A%20%20%20%20%20%20%20%20%23%20for%20custom%20data%2C%20show%20the%20actual%20values%20being%20used%0A%20%20%20%20%20%20%20%20true_values%20%3D%20true_labels.value%0A%20%20%20%20%20%20%20%20pred_values%20%3D%20pred_labels.value%0A%0A%20%20%20%20%20%20%20%20%23%20count%20positives%20and%20negatives%20to%20give%20useful%20feedback%0A%20%20%20%20%20%20%20%20try%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20true_arr%20%3D%20%5Bint(x.strip())%20for%20x%20in%20true_values.split('%2C')%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20pred_arr%20%3D%20%5Bint(x.strip())%20for%20x%20in%20pred_values.split('%2C')%5D%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20true_pos_count%20%3D%20sum(true_arr)%0A%20%20%20%20%20%20%20%20%20%20%20%20true_neg_count%20%3D%20len(true_arr)%20-%20true_pos_count%0A%20%20%20%20%20%20%20%20%20%20%20%20pred_pos_count%20%3D%20sum(pred_arr)%0A%20%20%20%20%20%20%20%20%20%20%20%20pred_neg_count%20%3D%20len(pred_arr)%20-%20pred_pos_count%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20scenario_msg%20%3D%20mo.md(f%22%22%22%0A%20%20%20%20%20%20%20%20%20%20%20%20**Current%20Data%20Summary%3A**%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**True%20Labels%3A**%20%7Btrue_pos_count%7D%20positive%2C%20%7Btrue_neg_count%7D%20negative%20(%7Btrue_pos_count%2Flen(true_arr)*100%3A.1f%7D%25%20positive)%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**Predicted%20Labels%3A**%20%7Bpred_pos_count%7D%20positive%2C%20%7Bpred_neg_count%7D%20negative%20(%7Bpred_pos_count%2Flen(pred_arr)*100%3A.1f%7D%25%20positive)%0A%20%20%20%20%20%20%20%20%20%20%20%20-%20**Total%20samples%3A**%20%7Blen(true_arr)%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%22%22%22).callout(kind%3D%22info%22)%0A%20%20%20%20%20%20%20%20except%3A%0A%20%20%20%20%20%20%20%20%20%20%20%20%23%20Fallback%20if%20there's%20an%20error%20parsing%20the%20input%0A%20%20%20%20%20%20%20%20%20%20%20%20scenario_msg%20%3D%20mo.md(%22Using%20custom%20data%20from%20the%20input%20fields%22).callout(kind%3D%22info%22)%0A%20%20%20%20else%3A%0A%20%20%20%20%20%20%20%20%23%20get%20values%20from%20the%20selected%20scenario%0A%20%20%20%20%20%20%20%20true_values%20%3D%20selected_scenario%5B%22true%22%5D%0A%20%20%20%20%20%20%20%20pred_values%20%3D%20selected_scenario%5B%22pred%22%5D%0A%0A%20%20%20%20%20%20%20%20%23%20informative%20message%20about%20the%20scenario%0A%20%20%20%20%20%20%20%20scenario_msg%20%3D%20mo.md(f%22%22%22%0A%20%20%20%20%20%20%20%20**%7Bexample_scenarios.value%7D**%0A%0A%20%20%20%20%20%20%20%20%7Bselected_scenario%5B%22description%22%5D%7D%0A%0A%20%20%20%20%20%20%20%20_Labels%20have%20been%20loaded%20into%20the%20input%20fields%20above._%0A%20%20%20%20%20%20%20%20%22%22%22).callout(kind%3D%22info%22)%0A%0A%20%20%20%20%23%20show%20interactive%20elements%0A%20%20%20%20input_section%20%3D%20mo.vstack(%5B%0A%20%20%20%20%20%20%20%20mo.md(%22%23%23%23%20Data%20Input%20and%20Parameters%22)%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5Btrue_labels%2C%20pred_labels%5D%2C%20gap%3D2)%2C%0A%20%20%20%20%20%20%20%20mo.hstack(%5Bbeta_input%2C%20example_scenarios%5D%2C%20gap%3D2)%2C%0A%20%20%20%20%20%20%20%20scenario_msg%0A%20%20%20%20%5D)%0A%20%20%20%20return%20(%0A%20%20%20%20%20%20%20%20input_section%2C%0A%20%20%20%20%20%20%20%20pred_arr%2C%0A%20%20%20%20%20%20%20%20pred_neg_count%2C%0A%20%20%20%20%20%20%20%20pred_pos_count%2C%0A%20%20%20%20%20%20%20%20pred_values%2C%0A%20%20%20%20%20%20%20%20scenario_msg%2C%0A%20%20%20%20%20%20%20%20selected_scenario%2C%0A%20%20%20%20%20%20%20%20true_arr%2C%0A%20%20%20%20%20%20%20%20true_neg_count%2C%0A%20%20%20%20%20%20%20%20true_pos_count%2C%0A%20%20%20%20%20%20%20%20true_values%2C%0A%20%20%20%20)%0A%0A%0A%40app.cell(hide_code%3DTrue)%0Adef%20_()%3A%0A%20%20%20%20%23%20Add%20user%20journey%20diagram%20showing%20how%20to%20use%20the%20notebook%0A%20%20%20%20journey_diagram%20%3D%20%22%22%22%0A%20%20%20%20journey%0A%20%20%20%20%20%20title%20%F0%9F%8E%AF%20F-Score%20Adventure%20Map%20%F0%9F%A7%AD%0A%20%20%20%20%20%20section%20%F0%9F%A7%A0%20Learn%0A%20%20%20%20%20%20%20%20Read%20intro%3A%205%3A%20Me%0A%20%20%20%20%20%20%20%20Check%20math%3A%203%3A%20Me%2C%20Brain%0A%20%20%20%20%20%20section%20%F0%9F%94%AC%20Play%0A%20%20%20%20%20%20%20%20Pick%20example%3A%204%3A%20Me%2C%20%F0%9F%90%AD%0A%20%20%20%20%20%20%20%20Set%20%CE%B2%20value%3A%203%3A%20Me%2C%20%F0%9F%A7%AA%0A%20%20%20%20%20%20%20%20Calculate%3A%205%3A%20Me%2C%20%F0%9F%A4%96%0A%20%20%20%20%20%20section%20%F0%9F%93%8A%20Explore%0A%20%20%20%20%20%20%20%20Visualize%3A%204%3A%20Me%2C%20%F0%9F%91%81%EF%B8%8F%0A%20%20%20%20%20%20%20%20Compare%20F-scores%3A%205%3A%20Me%2C%20%F0%9F%9A%80%0A%20%20%20%20%22%22%22%0A%20%20%20%20return%20(journey_diagram%2C)%0A%0A%0Aif%20__name__%20%3D%3D%20%22__main__%22%3A%0A%20%20%20%20app.run()%0A</marimo-code></head>
  <body>
    <div id="root"></div>
  </body>
</html>
